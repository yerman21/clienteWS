<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Application Home Page</title>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js" type="text/javascript"></script>
</head>
<body>
	<h1>TICKES DE DSCUENTOS</h1>
    <form id="formToQR" action="/convertToQR" method="post">
		<input type="text" name="producto" id="producto" placeholder="Producto"><br>
		<input type="text" name="descuento" id="descuento" placeholder="Descuento en %"><br>
        <input type="submit" value="Transformar">
    </form>

	<label id="msg"></label>
	<div id="divImg"></div>

 <script type="text/javascript">
 	$("#formToQR").on("submit", function(event){
 		event.preventDefault();

 		$("#divImg, #msg").html("");

 		$.post( "/convertToQR",{
 			producto: $("#producto").val(),
 			descuento: $("#descuento").val()
 		})
 		.then(function(result, textStatus, jqXHR ) {
	 			console.log(result);
	 			console.log(textStatus);
	 			console.log(jqXHR);

	 			if(jqXHR.status == 204){
	 				$("#divImg").html("");
					 $("#msg").html("Los datos son requeridos");
	 				return;
	 			}

				var myWindow = window.open(null, "Ticket Descuento");
				var htmlString = "<html><head><title></title></head><body>";
				htmlString += "<h2> Ticket de Descuento</h2>";
				htmlString += "<img src='data:image/jpg;base64,"+result.img64+"'>";
				htmlString += "</body></html>";

				myWindow.document.write(htmlString);
				myWindow.document.close();
				myWindow.onload = function(){ myWindow.print();	};
				//myWindow.print();

	 			$("#msg").html(result.msg);
 			}, function(fallo) {
	 			console.log(fallo);
	 			alert( "$.get failed!" );
 			}
 		);
 	});
 </script>
</body>
</html>